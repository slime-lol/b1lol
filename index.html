<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weekly Medallions Leaderboard</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #001f3f; /* Navy blue */
      color: #ffffff;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    #timer {
      font-size: 1rem;
      margin-bottom: 20px;
      color: #dddddd;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-width: 600px;
    }

    li {
      background-color: rgba(173, 216, 230, 0.3); /* Light blue with transparency */
      padding: 12px 16px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    li:nth-child(even) {
      background-color: rgba(173, 216, 230, 0.2); /* Zebra striping */
    }

    .left {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .rank {
      font-weight: bold;
      color: #ffd700;
      width: 2em;
      text-align: right;
    }

    .name {
      font-size: 1rem;
      color: #ffffff;
    }

    .score {
      font-weight: bold;
      color: #90ee90;
    }
  </style>
</head>
<body>
  <h1>Weekly Medallions Leaderboard</h1>
  <div id="timer">Loading timer...</div>
  <ul id="leaderboard">Loading leaderboard...</ul>

  <script>
    function weeksSinceBase() {
      const baseDate = new Date('2015-12-16T14:00:00+04:00');
      const now = new Date();
      const diffMs = now - baseDate;
      return Math.floor(diffMs / (7 * 24 * 60 * 60 * 1000)) + 1;
    }

    function getNextResetTime() {
      const baseDate = new Date('2015-12-16T14:00:00+04:00');
      const now = new Date();
      const weekNumber = weeksSinceBase() + 1;
      const nextReset = new Date(baseDate.getTime() + weekNumber * 7 * 24 * 60 * 60 * 1000);
      return nextReset;
    }

    function updateCountdown() {
      const now = new Date();
      const end = getNextResetTime();
      const diff = end - now;

      const totalSeconds = Math.floor(diff / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      const pad = (n) => String(n).padStart(2, '0');
      document.getElementById('timer').textContent =
        `Next refresh in: ${pad(days)}:${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }

    async function fetchLeaderboard() {
      const weeks = weeksSinceBase();
      const url = `https://priority-static-api.nkstatic.com/storage/static/appdocs/2/leaderboards/WeeklyMedallions:${weeks}.json`;

      try {
        const response = await fetch(url);
        const json = await response.json();
        const data = JSON.parse(json.data);
        const entries = data.scores.equal;

        const list = document.getElementById('leaderboard');
        list.innerHTML = '';

        entries.forEach(({ score, metadata }, index) => {
          const li = document.createElement('li');

          li.innerHTML = `
            <div class="left">
              <span class="rank">#${index + 1}</span>
              <span class="name">${metadata}</span>
            </div>
            <span class="score">${score.toLocaleString()}</span>
          `;

          list.appendChild(li);
        });

      } catch (err) {
        console.error('Failed to fetch leaderboard:', err);
        document.getElementById('leaderboard').textContent = 'Failed to load leaderboard data.';
      }
    }

    // Initialize
    fetchLeaderboard();
    updateCountdown();
    setInterval(updateCountdown, 1000); // update every second
  </script>
</body>
</html>
