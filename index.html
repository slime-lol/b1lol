<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaderboard Viewer</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #001f3f;
      color: #ffffff;
    }

    nav {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      background-color: #0074D9;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    button.active {
      background-color: #FF851B;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 5px;
    }

    #timer {
      font-size: 1rem;
      margin-bottom: 20px;
      color: #dddddd;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-width: 600px;
    }

    li {
      background-color: rgba(173, 216, 230, 0.3);
      padding: 12px 16px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    li:nth-child(even) {
      background-color: rgba(173, 216, 230, 0.2);
    }

    .left {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .rank {
      font-weight: bold;
      color: #ffd700;
      width: 2em;
      text-align: right;
    }

    .name {
      font-size: 1rem;
      color: #ffffff;
    }

    .score {
      font-weight: bold;
      color: #90ee90;
    }
  </style>
</head>
<body>
  <h1>Leaderboard Viewer</h1>
  <nav>
    <button id="weeklyBtn" class="active">Global</button>
    <button id="ratingBtn">Prestige</button>
  </nav>
  <h2 id="weeksSince"></h2>
  <div id="timer">Loading timer...</div>
  <ul id="leaderboard">Loading leaderboard...</ul>

  <script>
    let currentMode = 'weekly';
    const weeklyBtn = document.getElementById('weeklyBtn');
    const ratingBtn = document.getElementById('ratingBtn');

    weeklyBtn.onclick = () => { currentMode = 'weekly'; toggle(); };
    ratingBtn.onclick = () => { currentMode = 'rating'; toggle(); };

    function toggle(){
      weeklyBtn.classList.toggle('active', currentMode === 'weekly');
      ratingBtn.classList.toggle('active', currentMode === 'rating');
      fetchLeaderboard();
    }

    function weeksSinceBase() {
      const base = new Date('2015-12-16T14:00:00+04:00');
      return Math.floor((new Date() - base) / (7 * 24 * 60 * 60 * 1e3)) + 30;
    }

    function biweeksSinceBase() {
      // Season 1 start: Feb 18, 2017 14:00 GMT+4 â†’ convert to UTC by subtracting 4 hours
      const baseSeasonStart = new Date(Date.UTC(2017, 1, 15, 10, 0, 0)); // months 0-based, so 1=Feb
      const now = new Date();
      const biweekMs = 14 * 24 * 60 * 60 * 1000;
      const diffBiweeks = Math.floor((now - baseSeasonStart) / biweekMs);
      return 1 + diffBiweeks;
    }



    function getNextResetTime(mode) {
      if (mode === 'rating') {
        const base = new Date(Date.UTC(2017, 1, 15, 10, 0, 0)); // Feb 18, 2017 14:00 GMT+4
        const biweekMs = 14 * 24 * 60 * 60 * 1e3;
        const now = new Date();
        const elapsed = now - base;
        const nextBiweek = Math.ceil(elapsed / biweekMs);
        return new Date(base.getTime() + nextBiweek * biweekMs);
      } else {
        const base = new Date('2015-12-16T14:00:00+04:00');
        const weekMs = 7 * 24 * 60 * 60 * 1e3;
        const count = weeksSinceBase() - 29;
        return new Date(base.getTime() + count * weekMs);
      }
    }


    function updateCountdown() {
      const now = new Date();
      const end = getNextResetTime(currentMode);
      const diff = end - now;
      const s = Math.floor(diff / 1000);
      const d = Math.floor(s / 86400);
      const h = Math.floor((s % 86400) / 3600);
      const m = Math.floor((s % 3600) / 60);
      const sec = s % 60;
      const pad = n => n.toString().padStart(2, '0');
      const label = currentMode === 'weekly' ? "Next weekly reset in" : "Next season reset in";
      document.getElementById('timer').textContent =
        `${label}: ${pad(d)}:${pad(h)}:${pad(m)}:${pad(sec)}`;
      }


    async function fetchLeaderboard() {
      const container = document.getElementById('leaderboard');
      const label = document.getElementById('weeksSince');
      container.textContent = 'Loading...';
      try {
        let url, title, isRating = false;

        if (currentMode === 'weekly') {
          const w = weeksSinceBase();
          url = `https://priority-static-api.nkstatic.com/storage/static/appdocs/2/leaderboards/WeeklyMedallions:${w}.json`;
          title = `WEEK #${w}`;
        } else {
          const b = biweeksSinceBase();
          url = `https://priority-static-api.nkstatic.com/storage/static/appdocs/2/leaderboards/ladder:Season_${b}:Rating.json`;
          title = `SEASON #${b}`;
          isRating = true;
        }

        const res = await fetch(url);
        const { error, data } = await res.json();
        if (error) throw new Error(error);
        const parsed = JSON.parse(data);
        const entries = parsed.scores.equal;

        label.textContent = title;
        container.innerHTML = '';
        entries.forEach((e, i) => {
          const score = isRating ? e.score / 10 : e.score;
          const li = document.createElement('li');
          li.innerHTML = `
            <div class="left">
              <span class="rank">#${i + 1}</span>
              <span class="name">${e.metadata}</span>
            </div>
            <span class="score">${score.toLocaleString()}</span>`;
          container.appendChild(li);
        });
      } catch (err) {
        console.error(err);
        container.textContent = 'Failed to load leaderboard.';
      }
    }

    fetchLeaderboard();
    updateCountdown();
    setInterval(updateCountdown, 1000);
  </script>
</body>
</html>
