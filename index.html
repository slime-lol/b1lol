<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaderboard Viewer</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #001f3f;
      color: #ffffff;
    }

    nav {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      background-color: #0074D9;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    button.active {
      background-color: #FF851B;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 5px;
    }

    #timer {
      font-size: 1rem;
      margin-bottom: 20px;
      color: #dddddd;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-width: 600px;
    }

    li {
      background-color: rgba(173, 216, 230, 0.3);
      padding: 12px 16px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    li:nth-child(even) {
      background-color: rgba(173, 216, 230, 0.2);
    }

    .left {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .rank {
      font-weight: bold;
      color: #ffd700;
      width: 2em;
      text-align: right;
    }

    .name {
      font-size: 1rem;
      color: #ffffff;
    }

    .score {
      font-weight: bold;
      color: #90ee90;
    }
  </style>
</head>
<body>
  <h1>Leaderboard Viewer</h1>
  <nav>
    <button id="weeklyBtn" class="active">Global</button>
    <button id="ratingBtn">Prestige</button>
  </nav>
  <h2 id="weeksSince"></h2>
  <div id="timer">Loading timer...</div>
  <ul id="leaderboard">Loading leaderboard...</ul>

  <script>
    let currentMode = 'weekly'; // 'weekly' or 'rating'

    const weeklyBtn = document.getElementById('weeklyBtn');
    const ratingBtn = document.getElementById('ratingBtn');

    weeklyBtn.onclick = () => {
      currentMode = 'weekly';
      setActiveButton();
      fetchLeaderboard();
    };

    ratingBtn.onclick = () => {
      currentMode = 'rating';
      setActiveButton();
      fetchLeaderboard();
    };

    function setActiveButton() {
      weeklyBtn.classList.toggle('active', currentMode === 'weekly');
      ratingBtn.classList.toggle('active', currentMode === 'rating');
    }

    function weeksSinceBase() {
      const baseDate = new Date('2015-12-16T14:00:00+04:00');
      const now = new Date();
      const diffMs = now - baseDate;
      return Math.floor(diffMs / (7 * 24 * 60 * 60 * 1000)) + 30;
    }

    function biweeksSinceBase() {
      const baseDate = new Date('2015-12-16T14:00:00+04:00');
      const now = new Date();
      const diffMs = now - baseDate;
      return Math.floor(diffMs / (14 * 24 * 60 * 60 * 1000));
    }

    function getNextResetTime() {
      const baseDate = new Date('2015-12-16T14:00:00+04:00');
      const now = new Date();
      const weekNumber = weeksSinceBase() - 29;
      return new Date(baseDate.getTime() + weekNumber * 7 * 24 * 60 * 60 * 1000);
    }

    function updateCountdown() {
      const now = new Date();
      const end = getNextResetTime();
      const diff = end - now;

      const totalSeconds = Math.floor(diff / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      const pad = (n) => String(n).padStart(2, '0');
      document.getElementById('timer').textContent =
        `Next refresh in: ${pad(days)}:${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }

    async function fetchLeaderboard() {
      const list = document.getElementById('leaderboard');
      const weekLabel = document.getElementById("weeksSince");
      list.innerHTML = 'Loading leaderboard...';

      try {
        let url = '';
        let label = '';

        if (currentMode === 'weekly') {
          const weeks = weeksSinceBase();
          url = `https://priority-static-api.nkstatic.com/storage/static/appdocs/2/leaderboards/WeeklyMedallions:${weeks}.json`;
          label = "WEEK #" + weeks;
        } else {
          const biweeks = biweeksSinceBase();
          url = `https://priority-static-api.nkstatic.com/storage/static/appdocs/2/leaderboards/ladder:Season_${biweeks}:Rating.json`;
          label = "BI-WEEK #" + biweeks;
        }

        const response = await fetch(url);
        const json = await response.json();
        const data = JSON.parse(json.data);
        const entries = data.scores.equal;

        weekLabel.textContent = label;
        list.innerHTML = '';

        entries.forEach(({ score, metadata }, index) => {
          const li = document.createElement('li');

          li.innerHTML = `
            <div class="left">
              <span class="rank">#${index + 1}</span>
              <span class="name">${metadata}</span>
            </div>
            <span class="score">${score.toLocaleString()}</span>
          `;

          list.appendChild(li);
        });

      } catch (err) {
        console.error('Failed to fetch leaderboard:', err);
        list.textContent = 'Failed to load leaderboard data.';
      }
    }

    fetchLeaderboard();
    updateCountdown();
    setInterval(updateCountdown, 1000);
  </script>
</body>
</html>
