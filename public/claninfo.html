<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Clan Info</title>
<style>
  @font-face {
    font-family: 'OETZTYP';
    src: url('/OETZTYP_.TTF') format('truetype');
    font-weight: normal;
    font-style: normal;
  }

  body {
    font-family: 'OETZTYP', sans-serif;
    background-color: #19003f;
    color: #eee;
    margin: 0;
    padding: 20px;
  }

  h1 {
    font-size: 2rem;
    color: #ffd700;
    margin-bottom: 10px;
    text-align: center;
  }

  .container {
    max-width: 700px;
    margin: 0 auto;
    background-color: rgba(0,0,0,0.5);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  }

  .info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    margin-bottom: 10px;
    background-color: rgba(173,216,230,0.15);
    border-radius: 8px;
  }

  .info:nth-child(even) {
    background-color: rgba(173,216,230,0.1);
  }

  .label {
    font-weight: bold;
    color: #ffffff;
    min-width: 120px;
  }

  .value {
    text-align: right;
    color: #ffd700;
    word-break: break-word;
  }

  #badgePreview {
    display: block;
    margin: 10px auto;
    width: 80px;
    height: 80px;
    background-color: rgba(255,255,255,0.05);
    border-radius: 50%;
  }

</style>
</head>
<body>

<h1 id="clanName">Loading Clan...</h1>
<div class="container">
  <div id="badgePreview"></div>
  <div class="info"><span class="label">Guild ID:</span> <span class="value" id="guildID"></span></div>
  <div class="info"><span class="label">Owner:</span> <span class="value" id="owner"></span></div>
  <div class="info"><span class="label">Status:</span> <span class="value" id="status"></span></div>
  <div class="info"><span class="label">Members:</span> <span class="value" id="members"></span></div>
  <div class="info"><span class="label">Max Members:</span> <span class="value" id="maxMembers"></span></div>
  <div class="info"><span class="label">Tagline:</span> <span class="value" id="tagline"></span></div>
  <div class="info"><span class="label">Shortcode:</span> <span class="value" id="shortcode"></span></div>
  <div class="info"><span class="label">Chat Enabled:</span> <span class="value" id="chatEnabled"></span></div>
</div>
<script>
async function fetchClanInfo() {
  const urlParams = new URLSearchParams(window.location.search);
  const guildID = urlParams.get('id');
  if (!guildID) {
    document.getElementById('clanName').textContent = 'No Guild ID provided';
    return;
  }

  try {
    // Fetch clan info
    const res = await fetch(`https://priority-static-api.nkstatic.com/storage/static/appdocs/2/guilds/${guildID}`);
    const clan = await res.json();

    document.getElementById('clanName').textContent = clan.name;
    document.getElementById('guildID').textContent = clan.guildID;

    // Fetch owner username by NKID from correct URL
    let ownerName = clan.owner; // fallback
    try {
      const ownerRes = await fetch(`https://priority-static-api.nkstatic.com/storage/static/2/${clan.owner}/PublicProfile.save`);
      const ownerData = await ownerRes.json();
      if (ownerData.username) ownerName = ownerData.Name;
    } catch(e) {
      console.warn('Failed to fetch owner username, using NKID.');
    }

    // Render owner as clickable link
    const ownerEl = document.getElementById('owner');
    ownerEl.innerHTML = `<a href="user.html?id=${clan.owner}" style="color:#ffd700;">${ownerName}</a>`;

    document.getElementById('status').textContent = clan.status;
    document.getElementById('members').textContent = clan.numMembers + (clan.numMembersPending ? ` (+${clan.numMembersPending} pending)` : '');
    document.getElementById('maxMembers').textContent = clan.maximumMembers;

    let taglineText = clan.tagline;
    try {
      const tg = JSON.parse(clan.tagline);
      if (tg.Tagline) taglineText = tg.Tagline;
    } catch(e) {}
    document.getElementById('tagline').textContent = taglineText;

    document.getElementById('shortcode').textContent = clan.shortcode;
    document.getElementById('chatEnabled').textContent = clan.chatEnabled ? 'Yes' : 'No';

    // Optional: placeholder for badge
    const badge = document.getElementById('badgePreview');
    badge.textContent = "Clan Badge";

  } catch (err) {
    console.error(err);
    document.getElementById('clanName').textContent = 'Failed to load clan info';
  }
}

fetchClanInfo();
</script>
</body>
</html>
